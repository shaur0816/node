<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3C ç”¢å“ç¯©é¸å™¨</title>
  <style>
    body{
      font-family: "Noto Sans TC", sans-serif;
      background:#f2f0fb;
      margin:0;padding:30px;
    }
    .container{max-width:900px;margin:0 auto;background:#fff;padding:28px;border-radius:14px;box-shadow:0 6px 18px rgba(70,60,120,0.08);}
    .form-row{display:flex;gap:18px}
    .input-box{flex:1;display:flex;flex-direction:column}
    label{font-size:14px;margin-bottom:6px}
    input[type="number"]{padding:12px;border-radius:10px;border:1px solid #d6d6d8;font-size:16px}
    .btn{margin-top:22px;padding:14px;border-radius:12px;border:0;background:linear-gradient(90deg,#5a62ec,#9b59b6);color:#fff;font-size:18px;cursor:pointer;width:100%}
    .result-title{margin-top:28px;display:flex;align-items:center;justify-content:space-between}
    .badge{background:#5a62ec;color:#fff;padding:6px 12px;border-radius:999px;font-size:14px}
    .result-list{margin-top:18px}
    .card{background:#fff;border:1px solid #e6e6ea;border-radius:12px;padding:20px;margin-bottom:16px;box-shadow:0 2px 0 rgba(0,0,0,0.02)}
    .name{font-size:20px;font-weight:700}
    .price{color:#5064f1;margin-top:10px;font-weight:700}
    .empty{padding:30px;text-align:center;color:#666;border:1px dashed #e0e0e8;border-radius:12px}
    .hint{color:#c0392b;margin-top:10px;font-size:14px}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” 3C ç”¢å“ç¯©é¸å™¨</h1>
    <p style="color:#666;margin-top:4px">è¨­å®šåƒ¹æ ¼ç¯„åœï¼Œæ‰¾å‡ºç¬¦åˆé ç®—çš„å•†å“</p>

    <div class="form-row" style="margin-top:18px">
      <div class="input-box">
        <label>æœ€ä½åƒ¹æ ¼ï¼ˆå…ƒï¼‰</label>
        <input id="minPrice" type="number" value="200" min="0">
      </div>
      <div class="input-box">
        <label>æœ€é«˜åƒ¹æ ¼ï¼ˆå…ƒï¼‰</label>
        <input id="maxPrice" type="number" value="500" min="0">
      </div>
    </div>

    <button id="searchBtn" class="btn">ğŸ” æœå°‹ç”¢å“</button>
    <div class="result-title">
      <div style="font-size:18px;font-weight:700;margin-top:6px">æœå°‹çµæœ</div>
      <div id="resultBadge" class="badge">0 ä»¶å•†å“</div>
    </div>

    <div id="resultArea" class="result-list"></div>
    <div id="errorHint" class="hint" style="display:none"></div>
  </div>

<script>
  // --- æœ¬åœ° mock dataï¼ˆçœŸå¯¦ API ä¸å¯ç”¨æ™‚æœƒ fallbackï¼‰ ---
  const MOCK_API_DATA = {
    "min": 5000,
    "max": 20000,
    "totalProducts": 6,
    "matchedCount": 4,
    "matchedProducts": [
      { "id": 1, "name": "æ‰‹æ©Ÿ", "price": 12900 },
      { "id": 3, "name": "å¹³æ¿", "price": 15900 },
      { "id": 5, "name": "è¢å¹•", "price": 6990 },
      { "id": 6, "name": "Dellå¤§è¢å¹•", "price": 12990 }
    ]
  };

  const searchBtn = document.getElementById('searchBtn');
  const resultArea = document.getElementById('resultArea');
  const resultBadge = document.getElementById('resultBadge');
  const errorHint = document.getElementById('errorHint');

  searchBtn.addEventListener('click', async () => {
    errorHint.style.display = 'none';
    const minVal = Number(document.getElementById('minPrice').value);
    const maxVal = Number(document.getElementById('maxPrice').value);

    // é©—è­‰
    if (Number.isNaN(minVal) || Number.isNaN(maxVal)) {
      showError('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ç¯„åœã€‚');
      return;
    }
    if (minVal > maxVal) {
      showError('æœ€ä½åƒ¹æ ¼ä¸å¯å¤§æ–¼æœ€é«˜åƒ¹æ ¼ã€‚');
      return;
    }

    // å˜—è©¦å‘¼å«çœŸå¯¦ APIï¼ˆè‹¥æœ‰ï¼‰
    const apiUrl = `products?min=${encodeURIComponent(minVal)}&max=${encodeURIComponent(maxVal)}`;
    let data = null;

    try {
      // å¦‚æœä½ æœ‰å¾Œç«¯ serverï¼Œé€™è£¡æœƒå¯¦éš›å‘¼å«å®ƒ
      const resp = await fetch(apiUrl, { method: 'GET' });
      if (!resp.ok) throw new Error('fetch failed');
      data = await resp.json();
      // è‹¥å¾Œç«¯å›å‚³ matchedProductsï¼Œé€™æ®µæœƒç”¨å¾Œç«¯çš„ç¯©é¸çµæœ
    } catch (err) {
      // fetch å¤±æ•—æˆ–æ²’æœ‰å¾Œç«¯æ™‚ï¼Œä½¿ç”¨æœ¬åœ° mockï¼Œä¸¦ä»¥å‰ç«¯è¼¸å…¥çš„ç¯„åœåšç¯©é¸
      data = filterMockByRange(MOCK_API_DATA, minVal, maxVal);
    }

    renderResults(data, minVal, maxVal);
  });

  function showError(text){
    errorHint.innerText = text;
    errorHint.style.display = 'block';
  }

  // ç•¶å¾Œç«¯ä¸å¯ç”¨æ™‚ï¼Œç”¨æœ¬åœ°è³‡æ–™å†ä»¥å‰ç«¯è¼¸å…¥åšéæ¿¾
  function filterMockByRange(apiMock, min, max){
    const filtered = apiMock.matchedProducts.filter(p => (p.price >= min && p.price <= max));
    return {
      min,
      max,
      totalProducts: apiMock.totalProducts,
      matchedCount: filtered.length,
      matchedProducts: filtered
    };
  }

  function renderResults(data, min, max){
    // data æ‡‰åŒ…å« matchedCount, matchedProducts
    const count = (data && typeof data.matchedCount === 'number') ? data.matchedCount : 0;
    resultBadge.innerText = count + ' ä»¶å•†å“';

    resultArea.innerHTML = '';
    if (!data || !Array.isArray(data.matchedProducts) || data.matchedProducts.length === 0) {
      resultArea.innerHTML = '<div class="empty">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å•†å“ï¼ˆç¯„åœï¼šNT$ ' + min.toLocaleString() + ' â€“ NT$ ' + max.toLocaleString() + 'ï¼‰</div>';
      return;
    }

    // é¡¯ç¤ºæ¯ä¸€é …
    data.matchedProducts.forEach(p => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="name">${escapeHtml(p.name)}</div>
        <div class="price">NT$ ${Number(p.price).toLocaleString()}</div>
      `;
      resultArea.appendChild(card);
    });
  }

  // å°å·¥å…·ï¼šé¿å… XSSï¼ˆé›–ç„¶ç›®å‰ç”¨çš„éƒ½æ˜¯éœæ…‹ï¼‰
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }

  // é è¨­å…ˆè·‘ä¸€æ¬¡ï¼ˆå¯åˆªï¼‰
  // searchBtn.click();
</script>
</body>
</html>